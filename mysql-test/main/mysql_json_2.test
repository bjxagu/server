--echo #
--echo # MDEV-18323: Convert MySQL JSON type to MariaDB TEXT in mysql_upgrade
--echo # Test 2 (field treated as a blob):
--echo # Can read .frm file from mysql table containg the json data,
--echo # but is not well structured
--echo #

let $datadir=`select @@datadir`;

#drop table if exists mysql_json;

# Make sure you have placed `json.[frm/myd/myi]` files in `source/mysql-test/std_data/`
--copy_file std_data/json.frm $datadir/test/mysql_json.frm
--copy_file std_data/json.MYI $datadir/test/mysql_json.MYI
--copy_file std_data/json.MYD $datadir/test/mysql_json.MYD

--error ER_TABLE_NEEDS_REBUILD
select * from test.mysql_json;
--error ER_TABLE_NEEDS_REBUILD
alter table test.mysql_json;
alter table test.mysql_json force;
select * from test.mysql_json;

# We cannot read now
#--error ER_TABLE_NEEDS_REBUILD
#select * from test.mysql_json;

# Create other table to test other data types
--copy_file std_data/t1.frm $datadir/test/t1.frm
--copy_file std_data/t1.MYI $datadir/test/t1.MYI
--copy_file std_data/t1.MYD $datadir/test/t1.MYD

# We cannot read now
#--error ER_TABLE_NEEDS_REBUILD
#select * from test.t1;

--echo # Extend `Alter table <table_name> force ` @todo
#alter table test.t1 force;
# Now should be able to read data as mariadb table
#select * from test.t1;

drop table mysql_json;
drop table t1;
